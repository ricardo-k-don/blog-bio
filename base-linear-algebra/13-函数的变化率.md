# 函数的变化率

- 一元函数：$f: ℝ → ℝ$
- 多元函数：$f: ℝ^n → ℝ$
- 向量函数：$f: ℝ^n → ℝ^m$

## 1. 微分

微积分需要连续，连续需要无穷小。

### 1.1. 导数

导数：瞬时变化率的近似，是一元函数的变化率，原函数的近似为

$$
f(x) ≈ f(x_0) + f^{′}(x_0)(x - x_0)
$$

- 非指数型导数

推导可使用矩形面积变化，即给边长赋予相应的值，如$x\sin(x)$

1. 令边长分别为$x$和$\sin(x)$，则面积$A =x\sin(x)$
2. 令两边分别增长$dx$和$d\sin(x)$，可得新面积$A'$
3. $ΔA = x^2d(\sin(x)) + d(x^2)\sin(x)$
4. $f^{′}(x) = \dfrac{ΔA}{dx}$

> 反比例函数$\dfrac1{x}$ 可令两边分别为$x$和$\dfrac{1}{x}$

- 指数型导数

对$M = 2^t$，有

$$
\frac{dM}{dt} = \frac{2^{t+dt} - 2^t}{dt} = 2^t\bigg(\frac{2^{dt}-1}{dt}\bigg)
$$

其中，$\dfrac{2^{dt}-1}{dt}$收敛。当常数$2$被替换成$e$时，这个比例收敛于$1$。即，$e^t$的导数为自身。

由此，令$2 = e^{\ln(2)}$，即可得到$\dfrac{2^{dt}-1}{dt}$的收敛值。

### 1.2. l'Hôpital 法则

若两条曲线，$f(x)$和$g(x)$在$x=a$处相交，则其在$x=a$的比值的极限等于其导数在$x=a$的比值。

### 1.3. 中值定理

求曲线在区间$\big[a, b\big]$内到横轴的平均长度，即求曲线面积（矩形法求积分）与$\big[a, b\big]$内点的个数。其中，点的个数约等于$\dfrac{b - a}{dx}$。由此可得

$$
f(ξ) = \frac{\displaystyle ∫_a^b f(x)}{(b - a)/dx} = \frac{\displaystyle ∫_a^b f(x)dx}{b - a}
$$

即

$$
平均高度 = \frac{面积}{宽度}
$$

## 2. 梯度

梯度为多元函数的变化率，其表达式为一个偏导数组成的向量

$$
∇f =
\begin{bmatrix}
  \dfrac{∂f}{∂x_1} \\
  \dfrac{∂f}{∂x_2} \\
  ⋮ \\
  \dfrac{∂f}{∂x_n}
\end{bmatrix}
$$

原函数的近似为

$$
f(𝒙) ≈ f(𝒙_0) + ∇f(𝒙_0)⋅(𝒙 - 𝒙_0)
$$

## 3. Jacobian 矩阵

对向量函数$f$，其表达式为

$$
f(𝒙) =
\begin{bmatrix}
f_1(x_1, ⋯, x_n) \\
⋮ \\
f_m(x_1, ⋯, x_n)
\end{bmatrix}
$$

其中，$f_i: D → ℝ, D ⊆ ℝ^n$是$f$的定义域。对于单变量函数$f(x)$，在$x_0$附近可以用直线$y = ax + b$，近似$f(x)$。

推理至多变量，即有式$(1.1)$。由于在$𝒙 = 𝒙_0$，有$T(𝒙_0) = f(𝒙_0)$，则可得

$$
T(𝒙) = 𝑨(𝒙 - 𝒙_0) + f(𝒙_0)
$$

当$𝒙 → 𝒙_0$，若存在$m × n$阶实矩阵$𝑨$，使得

$$
\underset{𝒙 → 𝒙_0}{\lim} \dfrac{f(𝒙) - f(𝒙_0) - 𝑨(𝒙 - 𝒙_0)}{∥𝒙 - 𝒙_0∥} = 𝟎
$$

则称$f$在$𝒙 = 𝒙_0$可导。为了让$𝒙$从任意方向逼近$𝒙_0$，另要求$𝒙_0$是定义域$D$的一个内点（interior point），意思是$𝒙_0$的附近点都属于$D$。

此时，$f$的变化率为

$$
𝑱 =
\begin{bmatrix}
    \dfrac{∂𝒇}{∂x_1} & ⋯ & \dfrac{∂𝒇}{∂x_n}
\end{bmatrix} =
\begin{bmatrix}
\dfrac{∂f_1}{∂x_1} & ⋯ & \dfrac{∂f_1}{∂x_n} \\
⋮ & ⋱ & ⋮ \\
\dfrac{∂f_m}{∂x_1} & ⋯ & \dfrac{∂f_m}{∂x_n}
\end{bmatrix}
$$

此矩阵即 Jacobian 矩阵。原函数的近似为

$$
\begin{aligned}
  f(𝒙) &≈ f(𝒙_k) + ∇f(𝒙_k)⋅(𝒙 - 𝒙_k) \\
  &≡ f(𝒙_k) + 𝑱_{𝒙_k}⋅(𝒙 - 𝒙_k)
\end{aligned}
$$

## 4. Hessian 矩阵

对于多元函数$f$，其二阶导数为$n$阶方阵

$$
𝑯 =
\begin{bmatrix}
    \dfrac{∂^2 f}{∂x_1^2} & \dfrac{∂^2 f}{∂x_1 ∂x_2} & ⋯ & \dfrac{∂^2 f}{∂x_1 ∂x_n} \\
    \dfrac{∂^2 f}{∂x_2 ∂x_1} & \dfrac{∂^2 f}{∂x_2^2} & ⋯ & \dfrac{∂^2 f}{∂x_2 ∂x_n} \\
    ⋮ & ⋮ & ⋱ & ⋮ \\
    \dfrac{∂^2 f}{∂x_n ∂x_1} & \dfrac{∂^2 f}{∂x_n ∂x_2} & ⋯ & \dfrac{∂^2 f}{∂x_n^2}
\end{bmatrix}
$$

此为 Hessian 矩阵。

原函数的近似为

$$
f(𝒙) ≈ f(𝒙_0) + ∇f(𝒙_0)⋅(𝒙 - 𝒙_0) + \frac{1}{2}(𝒙 - 𝒙_0)^{⊤} 𝑯(𝒙_0)(𝒙 - 𝒙_0)
$$

### 4.1. 稳定性

当一元函数$f$在$x = x_0$点处具有二阶导数，且$f^{′}(x_0), f^{″}(x_0) ≠ 0$, 则

- $f^{″}(x_0) < 0$，$x_0$为极大值点
- $f^{″}(x_0) > 0$，$x_0$为极小值点
- $f^{″}(x_0) = 0$，$x_0$为鞍点
- $∄f^{″}(x_0)$，无法判断

当多元函数$f$在$𝒙 = 𝒙_0$处，$∇f(𝒙_0) = 𝟎$，则

- $𝑯$负定，$𝒙_0$为极大值点
- $𝑯$正定，$𝒙_0$为极小值点
- $𝑯$不定，$𝒙_0$为鞍点
- $∄𝑯^{-1}$，无法判断

### 4.2. 关系

$$
𝑯_f = 𝑱(∇f^{⊤})
$$

## 5. 线性化

### 5.1. Taylor 公式

Taylor 公式是将一个在$x = x_0$处具有$n$阶导数的函数$f(x)$利用关于$(x - x_0)$的$n$次多项式来逼近函数的方法。

若函数$f(x)$在包含$x_0$的某个闭区间$\big[a, b\big]$上具有$n$阶导数，且在开区间$(a, b)$上具有$(n + 1)$阶导数，则对闭区间$\big[a, b\big]$上任意一点 x，成立下式：

$$
f(x) = \dfrac{f(x_0)}{0!} + \dfrac{f^{′}(x_0)}{1!}(x - x_0) + … + \dfrac{f^{(n)}(x_0)}{n!}(x - x_0)^n +R_n(x)
$$

其中，$f^{(n)}$表示$f(x)$的$n$阶导数，等号后的多项式称为$f(x)$在$x_0$处的 Taylor 展开式，$R_n(x)$是 Taylor 公式的余项，是$(x - x_0)^n$的高阶无穷小；

- Peano 余项

$$
R_n(x) = ο((x - x_0)^n)
$$

- Lagrange 余项

$$
R_n(x) = f^{(n + 1)}\big[x_0 + θ(x - x_0)\big]\dfrac{(x - x_0)^{n+1}}{(n + 1)!}
$$

当$x - x_0 → 0$，则有

$$
f(x) = f(x_0) + f^{′}(x_0)(x - x_0)
$$

### 5.2. Maclaurin 公式

即$x_0 = 0$时的 Taylor 公式，即

$$
f(x) = ∑_{i=0}^n \dfrac{f^{(i)}(0)}{i!}(x)^i +R_n(x)
$$

### 5.3. 几何意义

线下的面积$f(x)$约等于区间$\big[0, a\big]$内曲线下的面积$f(a)$ + 加新增面积的矩形部分 + 新增面积的矩形上方的三角形部分。其中，高$h(x) = \dfrac{df}{dx}(x)$，则有

$$
f(x) ≈ f(a) + \frac{df}{dx}(a)⋅(x - a) + \frac{1}{2}⋅\frac{d^2f}{dx^2}(a)(x - a)^2
$$

:::{caution} 注意

线性化永远是局部的线性化

:::

## 6. 矩阵导数

### 6.1. 标量对向量的导数

**定义**：对向量

$$
\vec{y} = \begin{bmatrix}
y_1 \\ y_2 \\ ⋮ \\ y_m
\end{bmatrix}_{m × 1}
$$

若其函数$f(\vec{y})$为标量，则该函数的导数为

$$
\frac{∂f(\vec{y})}{∂\vec{y}} =
\begin{bmatrix}
\frac{∂f(\vec{y})}{∂y_1} \\
\frac{∂f(\vec{y})}{∂y_2} \\
⋮ \\
\frac{∂(\vec{y})}{∂y_m}
\end{bmatrix}_{m × 1}
$$

由于此导数形式与其分母部分相同，故称此形式为分母布局（denominator layout）。

类似，如果导数的行向量形式，称分子布局（nominator layout）。

### 6.2. 向量对向量的导数

**定义**：对向量$\vec{y}_{m × 1}$，若其函数$𝐟(\vec{y})$为向量，即

$$
𝐟(\vec{y})=
\begin{bmatrix}
f_1(\vec{y}) \\
f_2(\vec{y}) \\
⋮ \\
f_n(\vec{y})
\end{bmatrix}_{n × 1}
$$

则该函数的导数为

$$
\begin{bmatrix}
\frac{∂f(\vec{y})}{∂y_1} \\
\frac{∂f_{(\vec{y})}}{∂y_2} \\
⋮ \\
\frac{∂f(\vec{y})}{∂y_m}
\end{bmatrix}=
\begin{bmatrix}
\frac{∂f_1(\vec{y})}{∂y_1} & \frac{∂f_2{(\vec{y})}}{∂y_1} & ⋯ & \frac{∂f_n(\vec{y})}{∂y_1} \\
⋮ & & & ⋮ \\
⋮ & & ⋱ & ⋮ \\
\frac{∂f_1(\vec{y})}{∂y_m} & ⋯ & ⋯ & \frac{∂f_n(\vec{y})}{∂y_m}
\end{bmatrix}_{m × n}
$$

### 6.3. 引入矩阵

对向量$\vec{y}_{m × 1}$，和方阵$𝑨_{m × m}$，有

$$
\frac{∂𝑨\vec{y}}{∂\vec{y}} = 𝑨^{⊤}
$$

> 注意，此处采用分母布局。

$$
\frac{∂\vec{y}^{⊤} 𝑨 \vec{y}}{∂\vec{y}} = 𝑨 \vec{y} + A^{⊤}\vec{y}
$$

> 注意，分子为二次型！

当$𝑨$为对称阵

$$
\frac{∂\vec{y}^{⊤} 𝑨 \vec{y}}{∂\vec{y}} = 2𝑨 \vec{y}
$$
