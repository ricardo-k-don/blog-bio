# 图像压缩

## 1. JPEG 压缩

假设有一张图片，长宽皆为 512 个像素，我们用$x_i$来表示第$i$个像素，若是灰度照片，通常$x_i$可以在$\big[0, 255\big]$上取值，也就是 8 bits。对于这承载这张图片信息的向量$x$来说，有$x∈ ℝ^n, n =512^2$。而若是彩色照片，通常需要三个量来表示一个像素，则向量长度也会变为现在的三倍。

如此大的数据不经过压缩很难广泛传播。教学录像使用的压缩方法就是 JPEG（Joint Photographic Expert Group），该方法使用的就是基变换的方式压缩图像。如说一块干净的黑白，其附近的像素值应该非常接近，此时若一个像素一个像素的描述黑白灰度值就太浪费空间了，故标准基在这种情况下并不能很好的利用图片的特性。

标准基是$\begin{bmatrix}1\\0\\⋮\\0\end{bmatrix} \begin{bmatrix}0\\1\\⋮\\0\end{bmatrix}⋯\begin{bmatrix}0\\0\\⋮\\1\end{bmatrix}$，想寻找一个更好的基，如：

- 基中含有的一个向量$\begin{bmatrix}1 & 1 & ⋯ & 1\end{bmatrix}^{⊤}$，即分量全为$1$的向量，一个向量就可以完整的给出所有"像素一致图像"的信息；
- 另一个向量 $\begin{bmatrix}1 &-1 & ⋯ & 1 &-1\end{bmatrix}^{⊤}$，正负交替出现，如描述国际象棋棋盘；
- 第三个个向量 $\begin{bmatrix}1 & 1 & ⋯ &-1 &-1\end{bmatrix}^{⊤}$，一半正一半负，如描述一半亮一半暗的图片。

## 2. 基变换

将目标基的向量按列组成矩阵$W$，则基变换就是$\big[x\big]\xrightarrow{x = Wc} \big[c\big]$。

有线性变换$T: ℝ^8 → ℝ^8$，在第一组基$v_1, v_2, ⋯, v_8$上计算得到矩阵$𝑨$，在第二组基$w_1, w_2, ⋯, w_n$上计算得到矩阵$𝑩$。先说结论，矩阵$𝑨, 𝑩$是相似的，也就是有$𝑩 = 𝑴^{-1}𝑨𝑴$，而$𝑴$就是基变换矩阵。

进行基变换时会发生两件事：

- 每个向量都会有一组新的坐标，而$x = Wc$就是新旧坐标的关系；
- 每个线性变换都会有一个新的矩阵，而$𝑩 = 𝑴^{-1}𝑨𝑴$就是新旧矩阵的关系。

对于第一组基$v_1, v_2, ⋯, v_8$，要完全了解线性变换$T$，只需要知道$T$作用在基的每个向量上会产生什么结果即可。因为在这个基下的每个向量都可以写成$x = ∑_{i=1}^8 c_iv_i$的形式，故$T(x) = ∑_{i= 8}^n c_iT(v_i)$。

而且$T(v_1)∑_{i=1}^8 a_{i1}v_i, \ T(v_2) = ∑_{i=1}^8 a_{i2}v_i, \ ⋯$，则矩阵

$$
\begin{bmatrix}
𝑨
\end{bmatrix} = \begin{bmatrix}
a_{11} & a_{12} & ⋯ & a_{1n} \\
a_{21} & a_{22} & ⋯ & a_{2n} \\
⋮ & ⋮ & ⋱ & ⋮\\
a_{m1} & a_{m2} & ⋯ & a_{mn} \\
\end{bmatrix}
$$

设$v_1, v_2, ⋯, v_n$是一组特征向量，也就是$T(v_i) = λ_1v_i$，使用线性变换，输入的第一个向量$v_1$经由$T$加工后得到$λ_1v_1$，第二个向量$v_2\xrightarrow{T} λ_2v_2$，继续做下去，最终有$v_n = v_n\xrightarrow{T} λ_nv_n$。除了$λ_iv_i$外的其他基向量都变为$0$，则矩阵

$$
𝑨 = \begin{bmatrix} λ_1 &&&\\& λ_2 &&\\&& ⋱ &\\&&& λ_n\end{bmatrix}
$$

这是一个非常完美的基，在图像处理中最想要的就是这种基，但是找出像素矩阵的特征向量代价太大，故找了一些代价小同时效果也不错的基，如小波基、傅里叶基等等。

## 3. 傅里叶基

以$8×8$傅里叶基为例（这表示每次只处理$8×8$像素的一小块图像）：

$$
F_n = \begin{bmatrix}
1 & 1 & 1 & ⋯ & 1\\
1 & w & w^2 & ⋯ & w^{n-1} \\
1 & w^2 & w^4 & ⋯ & w^{2(n-1)} \\
⋮ & ⋮ & ⋮ & ⋱ & ⋮\\
1 & w^{n-1} & w^{2(n-1)} & ⋯ & w^{(n-1)^2}
\end{bmatrix}, \ w= e^{i2π/n}, \ n = 8
$$

每次处理$8×8$的一小块时，会遇到$64$个像素，也就是$64$个基向量，$64$个系数，在$64$维空间中利用傅里叶向量做基变换：

输入信号$x$为$64$维向量$\xrightarrow{基变换}$输出信号$c$为$x$在傅里叶基下的$64$个系数。

注意前面做的均是无损的步骤，我们只是选了$ℝ^{64}$的一组基，接着把信号用这组基表达出来。

接下来的步骤就涉及到压缩和损失了：一种方法是扔掉较小的系数，这称为阈值量化（thresholding），我们设定一个阈值，任何不在阈值范围内的基向量、系数都将丢弃，虽然有信息损失，但是只要阈值设置合理，肉眼几乎无法区别压缩前后的图片。经由这一步处理，向量$c$变为$ĉ$，而$ĉ$将有很多$0$。

通常$\begin{bmatrix}1 & 1 & ⋯ & 1\end{bmatrix}^{⊤}$向量很难被丢弃，它通常具有较大的系数。但是$\begin{bmatrix}1 &-1 & ⋯ & 1 &-1\end{bmatrix}^{⊤}$向量在平滑信号中的可能性就很小了。前一个的向量称作低频信号，频率为$ 0$，后一个向量称作高频信号，也是能够得到的最高频率的信号，若是噪音或抖动输出的就是它。

如讲课的视频图像信号，这种平滑的情形下输出的大多是低频信号，很少出现噪音。

接着用这些系数$ĉ$来重构信号，用这些系数乘以对应的基向量$x̂ = ∑ĉ_i v_i$，但是这个求和不再是$64$项求和了，因为压缩后的系数中有很多零存在，如说压缩后$ĉ$中仅有三个非零项，则压缩比将近达到$21:1$。

## 4. 小波基

同样以$8×8$为例：

$$
\begin{bmatrix}
1\\1\\1\\1\\1\\1\\1\\1
\end{bmatrix}
\begin{bmatrix}
1\\1\\1\\1\\-1\\-1\\-1\\-1
\end{bmatrix}
\begin{bmatrix}
1\\1\\-1\\-1\\0\\0\\0\\0
\end{bmatrix}
\begin{bmatrix}
0\\0\\0\\0\\1\\1\\-1\\-1
\end{bmatrix}
\begin{bmatrix}
1\\-1\\0\\0\\0\\0\\0\\0
\end{bmatrix}
\begin{bmatrix}
0\\0\\1\\-1\\0\\0\\0\\0
\end{bmatrix}
\begin{bmatrix}
0\\0\\0\\0\\1\\-1\\0\\0
\end{bmatrix}
\begin{bmatrix}
0\\0\\0\\0\\0\\0\\1\\-1
\end{bmatrix}
$$

可以看出傅里叶基中频率最高的向量为小波后四个基向量之和。

在标准基下的一组（按八个一组计算，$P ∈ ℝ^8$）像素

$$
P=
\begin{bmatrix}
  p_1\\ p_2 \\⋮ \\ p_8
\end{bmatrix} =
∑c_iw_i = \big[w_1\ w_2\ ⋯\ w_n\big]
\begin{bmatrix}
  c_1\\c_2\\⋮\\c_n
\end{bmatrix}
$$

即$P=WC$，我们需要计算像素向量在另一组基下系数，故有$C=W^{-1}P$。
